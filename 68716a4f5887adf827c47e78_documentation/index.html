
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>QuLab: Risk Management Framework Lab 2</title>
  <script src="../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <link rel="import" href="../../elements/codelab.html">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <style is="custom-style">
    body {
      font-family: "Roboto",sans-serif;
      background: var(--google-codelab-background, --paper-grey-300);
    }
  </style>
  
</head>
<body unresolved class="fullbleed">

  <google-codelab title="QuLab: Risk Management Framework Lab 2"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="Introduction and Setup" duration="300">
          Welcome to the QuLab Risk Management Framework Lab 2! This codelab will guide you through a Streamlit application designed to explore core concepts in financial risk management, specifically focusing on the Risk-Adjusted Return on Risk-Adjusted Capital (RARORAC) metric and portfolio quality visualization.  Understanding how financial institutions price risk and evaluate the profitability of deals is crucial. The <strong>Risk Management Framework</strong> is a structured approach used to identify, assess, mitigate, monitor, and report on risks. A key component within this framework is <strong>Risk-Sensitive Pricing</strong>, which ensures that the return generated from a deal is commensurate with the risk taken.  This application provides interactive tools to:  <ul>
<li>Calculate RARORAC for hypothetical deals based on various financial and risk parameters.</li>
<li>Save and compare different deal scenarios to understand the impact of changing inputs.</li>
<li>Visualize how the distribution of risk and return across a portfolio affects its overall quality, highlighting the consequences of risk-insensitive pricing.</li>
</ul>
  By completing this lab, you will gain practical intuition into how RARORAC works, how different factors influence deal profitability from a risk-adjusted perspective, and why managing the risk/return profile of a portfolio is essential for long-term financial health.   This application is built using **Streamlit**, a Python library that makes it easy to create and share beautiful, custom web apps for machine learning and data science. You&#39;ll see how Streamlit&#39;s interactive widgets and layout capabilities are used to build this financial modeling tool.   <h3>Application Structure</h3>
  The application consists of a main <code>app.py</code> file and three separate Python files in an <code>application_pages</code> directory, one for each page of the application:  <ul>
<li>code</li>
<li>code</li>
<li>code</li>
<li>code</li>
</ul>
  This modular structure helps keep the code organized and makes it easier to manage different sections of the application.  <h3>Running the Application</h3>
  To run this application, you need Python installed, preferably in a virtual environment. You also need to install the required libraries: <code>streamlit</code>, <code>pandas</code>, <code>numpy</code>, and <code>altair</code>.  <ol start="1">
<li>Save the provided code snippets into the correct file structure:  </li>
<li>code</li>
<li>code</li>
<li>code</li>
<li>code</li>
</ol>
 Open your terminal or command prompt. Navigate to the directory where you saved <code>app.py</code>. Install the required libraries: <code>console<br>pip install streamlit pandas numpy altair<br></code> Run the application using the streamlit command: <code>console<br>streamlit run app.py<br></code> Your web browser should open automatically to display the application.   

      </google-codelab-step>
    
      <google-codelab-step label="Understanding RARORAC Formulae" duration="300">
          The core of the first page and the entire concept revolves around the RARORAC formula. RARORAC helps financial institutions evaluate the risk-adjusted profitability of individual deals or lines of business. It compares the net income generated by a deal (adjusted for expected losses and operating costs) against the economic capital required to support the unexpected risks associated with that deal.  The application uses the following formulas, as presented on the main page:  $$ \text{Income_From_Deal} = \text{Loan_Amount} \times \text{Interest_Rate} + \text{Fees} $$  This calculates the total revenue generated from the deal, combining interest earned over a period (implicitly assumed to be one year based on standard annual rates) and any upfront fees.  $$ \text{Operating_Costs} = \text{Income_From_Deal} \times \text{Operating_Cost_Ratio} $$  These are the expenses incurred in originating, servicing, and managing the deal, often expressed as a percentage of the deal’s income.  $$ \text{Expected_Loss} = \text{Loan_Amount} \times \text{Expected_Loss_Rate} $$  This represents the average or statistically predicted loss that is expected to occur over the life of the loan due to credit default or other events. It’s a cost of doing business with a certain level of credit risk.  $$ \text{Net_Risk_Adjusted_Reward} = \text{Income_From_Deal} - \text{Operating_Costs} - \text{Expected_Loss} $$  This is the “numerator” of the RARORAC calculation. It’s the profit generated from the deal after accounting for the cost of operations and the statistically expected credit losses.  $$ \text{Risk_Adjusted_Capital} = \text{Loan_Amount} \times \text{Unexpected_Loss_Capital_Allocation_Factor} $$  This is the “denominator” of the RARORAC calculation. It represents the economic capital that must be held against this deal to cover potential <strong>unexpected</strong> losses beyond the expected loss level. This capital acts as a buffer to absorb large, infrequent losses and is often derived from internal risk models (e.g., Value at Risk, Expected Shortfall at a high confidence level). The <code>Unexpected_Loss_Capital_Allocation_Factor</code> is a simplified representation of the amount of capital required per unit of loan amount for this specific deal’s risk profile.  $$ \text{RARORAC} = \frac{\text{Net_Risk_Adjusted_Reward}}{\text{Risk_Adjusted_Capital}} $$  Finally, RARORAC is the ratio of the Net Risk-Adjusted Reward to the Risk-Adjusted Capital. It tells you how much risk-adjusted profit is generated for every unit of capital at risk to support unexpected losses. A higher RARORAC indicates a more profitable deal relative to the capital it consumes.  Financial institutions typically set a <strong>Hurdle Rate</strong>. This is the minimum acceptable RARORAC for a deal to be considered viable. If the calculated RARORAC is below the hurdle rate, the deal is considered insufficiently profitable for the risk involved.  

      </google-codelab-step>
    
      <google-codelab-step label="Using the RARORAC Calculator (Page 1)" duration="600">
          This step focuses on interacting with the first page of the application, the “RARORAC Calculator”, implemented in <code>application_pages/page1.py</code>.  <ol start="1">
<li>Ensure the application is running (</li>
<li>In the sidebar on the left, make sure “RARORAC Calculator” is selected under “Navigation”. This is usually the default page when the app starts.</li>
</ol>
  The main area of the page displays the title, description, and the RARORAC formulae (which you explored in the previous step). The interactive inputs for the calculator are located in the <strong>sidebar</strong>.  <ol start="1">
<li>p</li>
<li>strong</li>
<li>strong</li>
<li>strong</li>
<li>strong</li>
<li>strong</li>
<li>strong</li>
<li>strong</li>
</ol>
  Observe the “Calculated Metrics” section in the main area. As you change any of the input parameters in the sidebar, the values displayed here update dynamically. Streamlit automatically re-runs the relevant parts of the script (<code>run_page1</code> function) whenever an input widget changes.  <ul>
<li>strong</li>
<li>strong</li>
<li>strong</li>
<li>strong</li>
<li>strong</li>
<li>strong</li>
<li>strong</li>
</ul>
  Experiment with changing the input parameters.  <ul>
<li>Increase the </li>
<li>Increase the </li>
<li>Increase the </li>
<li>Change the </li>
</ul>
    The informational boxes next to each input field and calculated metric (using `st.info()`) provide context and explain what each term means in this financial context. Pay attention to these explanations as you explore.   The values you set and the resulting calculations on this page are stored in Streamlit’s <code>st.session_state</code>. This allows the next page (“Scenario Comparison”) to access these values.  

      </google-codelab-step>
    
      <google-codelab-step label="Saving and Comparing Scenarios (Page 2)" duration="420">
          This step explores the “Scenario Comparison” page, implemented in <code>application_pages/page2.py</code>. This page allows you to save the parameters and results from the RARORAC Calculator page and compare multiple scenarios in a table.  <ol start="1">
<li>p</li>
<li>p</li>
<li>p</li>
<li>Before coming to this page, ensure you calculated a RARORAC scenario on the “RARORAC Calculator” page by adjusting the parameters.</li>
<li>Enter a descriptive name for your scenario in the “Scenario Name” text input field (e.g., “Base Case Loan”, “High Risk - High Fee Loan”).</li>
<li>Click the “Save Current Scenario” button.</li>
<li>You should see a success message if a scenario was available to save. If you haven’t calculated a scenario on the first page, you will see a warning.</li>
</ol>
    The application uses <code>st.session_state</code> to store the saved scenarios. This data persists as long as your current browser session with the application is active. If you close the tab or restart the application, the saved scenarios will be lost.   <ol start="1">
<li>p</li>
<li>p</li>
<li>p</li>
<li>After saving one or more scenarios, they will appear in the table in the “Compare Scenarios” section.</li>
<li>The table (</li>
<li>Examine the table to easily compare the </li>
</ol>
  Use the “Clear All Scenarios” button to remove all saved scenarios from the session state. This is useful for starting a new comparison batch.   This scenario comparison feature helps demonstrate the importance of running different sensitivity analyses on potential deals and understanding how changes in underlying assumptions affect their risk-adjusted viability.  

      </google-codelab-step>
    
      <google-codelab-step label="Visualizing Portfolio Quality (Page 3)" duration="480">
          This step explores the “Portfolio Quality Visualization” page, implemented in <code>application_pages/page3.py</code>. This page moves from individual deals to a portfolio perspective, illustrating how the distribution of deals based on their risk and return characteristics impacts overall portfolio quality.  <ol start="1">
<li>p</li>
<li>p</li>
<li>p</li>
<li>strong</li>
<li>strong</li>
<li>strong</li>
<li>strong</li>
</ol>
  Observe the scatter plot displayed in the main area. Each point represents a hypothetical deal, plotted with ‘Risk Score’ on the x-axis and ‘Return Ratio’ on the y-axis.  Experiment with the parameters:  <ul>
<li>Start with the default settings (e.g., 100 deals, moderate ranges, ‘Skewed Portfolio’ unchecked). You should see a relatively even spread of points within the defined risk and return ranges.</li>
<li>Check the “Skewed Portfolio” box. How does the distribution of points change? You should notice a concentration of deals towards the lower-right area of the plot (higher risk, lower return).</li>
</ul>
    A portfolio distribution skewed towards higher risk and lower return (as simulated when the &#39;Skewed Portfolio&#39; box is checked) is indicative of poor risk-sensitive pricing or adverse selection. Such a portfolio is less profitable for the amount of risk taken and is vulnerable to significant losses.   <ol start="1">
<li>Uncheck the “Skewed Portfolio” box again.</li>
<li>Adjust the </li>
<li>Increase the </li>
</ol>
  This visualization helps reinforce the concept that not all deals contribute equally to portfolio value. Deals in the upper-left (lower risk, higher return) are highly desirable, while deals in the lower-right (higher risk, lower return) erode value from a risk-adjusted perspective. Effective risk management and risk-sensitive pricing aim to shift the portfolio distribution towards the upper-left or, at a minimum, ensure that higher risk is genuinely compensated by proportionally higher potential returns.  

      </google-codelab-step>
    
      <google-codelab-step label="Exploring the Code (Optional)" duration="600">
          This step provides a brief overview of the Python code behind the Streamlit application. You don’t need to be a Streamlit expert to understand the core logic, but this step helps connect the UI elements you interacted with to the underlying code.  <ol start="1">
<li>p</li>
<li>Notice the </li>
<li>code</li>
<li>code</li>
<li>code</li>
<li>code</li>
<li>The </li>
<li>The references are listed using </li>
</ol>
  Open <code>application_pages/page1.py</code>.  <ul>
<li>The </li>
<li>The </li>
<li>Inside </li>
<li>code</li>
<li>code</li>
<li>code</li>
<li>The calculated metrics are displayed using </li>
<li>The </li>
<li>code</li>
</ul>
   Open <code>application_pages/page2.py</code>.  <ul>
<li>code</li>
<li>The </li>
<li>The </li>
<li>The </li>
<li>Inside </li>
<li>code</li>
<li>code</li>
<li>code</li>
<li>The comparison table is displayed by calling </li>
</ul>
   Open <code>application_pages/page3.py</code>.  <ul>
<li>The </li>
<li>The </li>
<li>Inside </li>
<li>code</li>
<li>code</li>
<li>code</li>
<li>code</li>
</ul>
    This brief code tour shows how Streamlit widgets capture user input, how Python functions perform the calculations and data generation, and how Streamlit’s display elements (<code>st.metric</code>, <code>st.dataframe</code>, <code>st.altair_chart</code>) visualize the results. The use of <code>st.session_state</code> is key for sharing data (current deal, saved scenarios) between the different pages.  

      </google-codelab-step>
    
      <google-codelab-step label="Conclusion" duration="180">
          Congratulations! You have successfully explored the QuLab Risk Management Framework Lab 2 application.  Through this lab, you’ve interacted with key concepts in financial risk management:  <ul>
<li>strong</li>
<li>strong</li>
<li>strong</li>
</ul>
  This application provides a simplified yet powerful illustration of these fundamental principles that guide decision-making in financial institutions. Effective risk management isn’t just about avoiding losses; it’s also about ensuring that risk-taking is adequately compensated, contributing positively to risk-adjusted profitability and overall portfolio quality.  Feel free to continue experimenting with the parameters in the application to build further intuition about these concepts. You can also explore the provided code further to understand the implementation details.   Understanding risk-adjusted performance metrics like RARORAC is vital for anyone involved in lending, investment, or financial analysis, as it provides a more complete picture of performance than return metrics alone.  

      </google-codelab-step>
    
  </google-codelab>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-49880327-14', 'auto');

    (function() {
      var gaCodelab = '';
      if (gaCodelab) {
        ga('create', gaCodelab, 'auto', {name: 'codelab'});
      }

      var gaView;
      var parts = location.search.substring(1).split('&');
      for (var i = 0; i < parts.length; i++) {
        var param = parts[i].split('=');
        if (param[0] === 'viewga') {
          gaView = param[1];
          break;
        }
      }
      if (gaView && gaView !== gaCodelab) {
        ga('create', gaView, 'auto', {name: 'view'});
      }
    })();
  </script>

</body>
</html>
